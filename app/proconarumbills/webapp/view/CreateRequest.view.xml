<mvc:View controllerName="ns.proconarumbills.controller.CreateRequest"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:uxap="sap.uxap"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns="sap.m"
    xmlns:upload="sap.m.upload"
    xmlns:goals="sap.uxap.sample.SharedBlocks.goals"
    xmlns:personal="sap.uxap.sample.SharedBlocks.personal"
    xmlns:employment="sap.uxap.sample.SharedBlocks.employment" height="100%">
    <Page id="auditScoreDetailPage" showHeader="false" enableScrolling="true">
        <content>
            <uxap:ObjectPageLayout id="ObjectPageLayout" showTitleInHeaderContent="true" showEditHeaderButton="false" editHeaderButtonPress="handleEditBtnPress" upperCaseAnchorBar="false" showFooter="true">
                <uxap:headerTitle>
                    <uxap:ObjectPageDynamicHeaderTitle id="ObjectPageDynamicHeaderTitle">
                        <uxap:expandedHeading>
                            <Title id="Title" text="{i18n>createExpenseRequest}" wrapping="true"/>
                        </uxap:expandedHeading>
                        <uxap:snappedHeading>
                            <FlexBox id="FlexBox" fitContainer="true" alignItems="Center">
                                <Title id="Title2" text="{i18n>createExpenseRequest}" wrapping="true" />
                            </FlexBox>
                        </uxap:snappedHeading>

                    </uxap:ObjectPageDynamicHeaderTitle>
                </uxap:headerTitle>

                <uxap:sections>
                    <uxap:ObjectPageSection titleUppercase="false" id="goalsSection" title="{i18n>requestHeader}">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection id="goalsSectionSS1">
                            <VBox id="VBoxFormContainer" width="100%">
                                <f:SimpleForm id="editAuditScoreBasicData" editable="true" layout="ColumnLayout" labelSpanXL="2" labelSpanL="2" labelSpanM="2" labelSpanS="12" adjustLabelSpan="false" emptySpanXL="2" emptySpanL="2" emptySpanM="2" emptySpanS="2" columnsXL="2" columnsL="2" columnsM="2" singleContainerFullSize="false">
                                    <f:content>
                                        <Label id="Label13" text="Request Description" required="true"/>
                                        <Input id="requestDescription"
                                            placeholder="Transfer Office"
                                            ariaLabelledBy="InputNumberLabel"
                                            value="{auditScoreItemModel>/auditScore}"
                                            class="sapUiSmallMarginBottom"
                                            change="onBasicDataValidation" 
                                            editable="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_AUDIT_SCORE'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}" />

                                        <Label id="Label3" text="Currency" required="true"/>
                                        <Select id="currency" 
                                                selectedKey="{auditScoreItemModel>/auditLabel}" 
                                                editable="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_AUDIT_LABEL'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}"
                                                items="{susF4HelpSrv>/F4Help_RiskScoreAuditLabel}" 
                                                class="sapUiSmallMarginBottom">
                                            <core:Item id="currencyItems" key="{susF4HelpSrv>fieldValue}" text="{susF4HelpSrv>valueDescription}" />
                                        </Select>

                                        <Label id="Label2" text="Priority" required="false"/>
                                        <Select id="auditScoreDetailAuditLabel" 
                                                selectedKey="{auditScoreItemModel>/auditLabel}" 
                                                editable="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_AUDIT_LABEL'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}"
                                                items="{susF4HelpSrv>/F4Help_RiskScoreAuditLabel}" 
                                                class="sapUiSmallMarginBottom">
                                            <core:Item id="Item4" key="{susF4HelpSrv>fieldValue}" text="{susF4HelpSrv>valueDescription}" />
                                        </Select>

                                        <Label id="Label1" text="Due date" required="true" />
                                        <DatePicker id="auditScoreDetailValidTo" change="onBasicDataValidation" 
                                        editable="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_VALID_TO'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}"
                                        placeholder="23/04/2025" value="{
                                                            'path':'auditScoreItemModel>/validTo',
                                                            'type':'sap.ui.model.type.Date'
                                                        }" class="sapUiSmallMarginBottom" valueState="{fieldValueStateModel>/auditScoreValidToStage}"/>
                                        <Button id="Button1" width="0.5rem" icon="sap-icon://information" type="Transparent" press="onShowValidInputRequiredInformation"/>
                                    </f:content>
                                </f:SimpleForm>

                                <f:SimpleForm id="SimpleForm" editable="true" layout="ResponsiveGridLayout" >
                                    <f:content>
                                        <Label id="Label20" text="Request Information" required="true" />
                                        <TextArea editable="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_DESCRIPTION'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}"
                                                id="auditScoreDetailLongText" value="{auditScoreItemModel>/longText}" width="100%" rows="6" placeholder="Describe more detail your request" maxLength="5000"/>
                                    </f:content>
                                </f:SimpleForm>
                            </VBox>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <uxap:ObjectPageSection id="ObjectPageSection3" titleUppercase="false" title="{i18n>requestItems}">
                        <uxap:subSections>
                        	<uxap:ObjectPageSubSection id="ObjectPageSubSection2" >
                                <Table busyIndicatorDelay="0" id="idActivityWorklistTable" growing="true" growingThreshold="100" growingScrollToLoad="true" updateFinished="setPoTableHeader" mode="None" sticky="ColumnHeaders,HeaderToolbar" width="auto" items="{
                                        path: 'auditScoreItemModel>/activities',
                                        sorter: {
                                            path: 'activityNo',
                                            descending: true
                                        }}">
                                    <headerToolbar>
                                        <OverflowToolbar id="OverflowToolbar3">
                                            <Title id="idTableHeaderText" text="" level="H2"/>
                                        </OverflowToolbar>
                                    </headerToolbar>

                                    <columns>
                                        <Column id="activityNo" width="7%" hAlign="Left" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title11" text="{i18n>activityListActivityIdCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="supplierId" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title12" text="{i18n>activityListSupplierIdCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="supplierName" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title13" text="{i18n>activityListSupplierNameCol}" class="fontWeightBold" />
                                        </Column>
                                        <Column id="activityPriorityId" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title14" text="{i18n>activityListPriorityCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="statusId" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title15" text="{i18n>activityListStatusCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="pendingSteps" hAlign="End" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title16" text="{i18n>activityListPendingStepsCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="submittedSteps" hAlign="End" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title17" text="{i18n>activityListSubmittedStepsCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="riskTypeId"  width="10%" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title19" text="{i18n>activityListRiskTypeCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="activityTypeId" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title20" text="{i18n>activityListActivityTypeIdCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="startDate" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title21" text="{i18n>activityListStartDateCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="endDate" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title22" text="{i18n>activityListEndDateCol}" class="fontWeightBold" />
                                        </Column>

                                        <Column id="coordinatorId" hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title23" text="{i18n>activityListCoordinatedByCol}" class="fontWeightBold" />
                                        </Column>
                                    </columns>

                                    <items>
                                        <ColumnListItem id="columnListItemActivity" type="Navigation" press="onItemPressed">
                                            <cells>
                                                <Text id="textActivityNo" text="{path: 'auditScoreItemModel>activityNo', type: 'sap.ui.model.odata.type.String'}" />
                                                <Text id="textSupplierId" text="{path:'auditScoreItemModel>supplierId', formatter:'.formatter.fnFormatSupplierId'}" />
                                                <Text id="textSupplierName" text="{auditScoreItemModel>supplierName}" />
                                                <ObjectStatus id="objectPriority1" text="{auditScoreItemModel>activityPriorityText}" 
                                                    state="{path:'auditScoreItemModel>activityPriorityId', formatter:'.formatter.getActivityPriorityState'}" />
                                                <ObjectStatus id="objectStatus1" text="{auditScoreItemModel>statusText}" 
                                                    state="{path:'auditScoreItemModel>statusId', formatter:'.formatter.getActivityStatusState'}" />
                                                <Text id="textPendingSteps" text="{auditScoreItemModel>pendingSteps}" />
                                                <Text id="textSubmittedSteps" text="{auditScoreItemModel>submittedSteps}" />
                                                <Text id="textRiskType" text="{auditScoreItemModel>riskTypeText}" />
                                                <Text id="textActivityType" text="{auditScoreItemModel>activityTypeText}" />
                                                <Text id="textStartDate" text="{
                                                    path: 'auditScoreItemModel>startDate',
                                                    type: 'sap.ui.model.type.Date',
                                                    formatOptions:{
                                                        source: {
                                                            pattern: 'yyyy-MM-ddTHH:mm:ss.sssZ'
                                                        },
                                                        UTC: true
                                                    } 
                                                }" />
                                            <!-- //#170225-kiennt-Ticket521 - correct german date format -->
                                            <!-- <Text text="{
                                            path: 'auditScoreItemModel>startDate',
                                            type: 'sap.ui.model.odata.type.DateTimeOffset',
                                            constraints: {
                                                precision: 3,
                                                v4: true
                                            },
                                            formatOptions: {
                                                pattern: 'yyyy/MM/dd'
                                            }
                                            }" /> -->
                                            <Text id="Title24" text="{
                                                path: 'auditScoreItemModel>endDate',
                                                type: 'sap.ui.model.type.Date',
                                                formatOptions:{
                                                    source: {
                                                        pattern: 'yyyy-MM-ddTHH:mm:ss.sssZ'
                                                    },
                                                    UTC: true
                                                } 
                                            }" />
                                            <!-- //#170225-kiennt-Ticket521 - correct german date format -->
                                            <!-- <Text text="{
                                            path: 'auditScoreItemModel>endDate',
                                            type: 'sap.ui.model.odata.type.DateTimeOffset',
                                            constraints: {
                                                precision: 3,
                                                v4: true
                                            },
                                            formatOptions: {
                                                pattern: 'yyyy/MM/dd'
                                            }
                                            }" /> -->
                                                <Text id="Title25" text="{auditScoreItemModel>coordinatorName}" />
                                            </cells>
                                        </ColumnListItem>
                                    </items>
                                </Table>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <uxap:ObjectPageSection id="ObjectPageSection" titleUppercase="false" title="{i18n>requestAttachments}">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection id="ObjectPageSubSection" >
                                <upload:UploadSet   id="AuditScoreDetailUploadCollection" 
                                                    mode = "None" 
                                                    instantUpload="true"  
                                                    terminationEnabled="true" 
                                                    fileTypeMismatch="onTypeMissmatch" 
                                                    fileTypes="txt,doc,pdf,xlsx,png,jpg" 
                                                    sameFilenameAllowed="true" 
                                                    items="{auditScoreItemModel>/attachments}" 
                                                    fileNameLengthExceeded="onFileNameLength" 
                                                    fileSizeExceeded="onFileSizeExceeded" 
                                                    beforeItemEdited="onHandleBeforeEdit" 
                                                    afterItemEdited="onHandleAfterEditFile" 
                                                    beforeItemRemoved="onHandleBeforeRemoveFileUploadForAuditScore" 
                                                    afterItemRemoved="onHandleAfterRemoveFileUploadForAuditScore" 
                                                    afterItemAdded="onUploadAttachmentChangeForAuditScore"
                                                    uploadCompleted="onUploadCompleted"
                                                    uploadEnabled="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_UPLOAD_FILE'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}">
                                    <upload:items>
                                        <upload:UploadSetItem id="UploadSetItem" fileName="{auditScoreItemModel>fileName}" 
                                                                openPressed="onDownloadAttachment" 
                                                                url="#" 
                                                                enabledRemove="true" 
                                                                visibleEdit="false" 
                                                                visibleRemove="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_REMOVE_FILE'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}">
                                                <upload:statuses>
                                                    <ObjectStatus id="ObjectStatus2" title="{i18n>uploadedBy}" text="{auditScoreItemModel>createdBy}" active="false"/>
                                                    <ObjectStatus id="ObjectStatus3" title="{i18n>uploadedOn}" 
                                                                    text="{
                                                                        path: 'auditScoreItemModel>createdAt',
                                                                        type: 'sap.ui.model.odata.type.DateTimeOffset',
                                                                        constraints: {
                                                                            precision: 3,
                                                                            v4: true
                                                                        }
                                                                    }" active="false"/>
                                                    <!-- //#170225-kiennt-Ticket521 - correct german date format -->
                                                    <!-- <ObjectStatus title="{i18n>uploadedOn}" 
                                                                    text="{
                                                                        path: 'auditScoreItemModel>createdAt',
                                                                        type: 'sap.ui.model.odata.type.DateTimeOffset',
                                                                        constraints: {
                                                                            precision: 3,
                                                                            v4: true
                                                                        },
                                                                        formatOptions: {
                                                                            pattern: 'dd/MM/yyyy HH:mm:ss'
                                                                        }
                                                                    }" active="false"/> -->
                                                </upload:statuses>                
                                        </upload:UploadSetItem>
                                    </upload:items>
                                </upload:UploadSet>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <uxap:ObjectPageSection id="ObjectPageSection2" titleUppercase="false" title="{i18n>requestComments}">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection id="ObjectPageSubSection4">
                                <f:SimpleForm id="SimpleForm2" editable="true" layout="ResponsiveGridLayout" >
                                    <f:content>
                                        <TextArea editable="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_DESCRIPTION'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnEnabled'}"
                                                  id="auditScoreDetailLongText2" value="{auditScoreItemModel>/longText}" width="100%" rows="6" placeholder="{i18n>longDescMaxLength}" maxLength="5000"/>
                                    </f:content>
                                </f:SimpleForm>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>
                </uxap:sections>

                <uxap:footer>
                    <OverflowToolbar id="overflowToolbarFooter">
                        <ToolbarSpacer id="toolbarSpacerFooter" />
                        <Button id="btnSubmitAuditScore" type="Default" text="Save Draft" press="onSubmitAuditScore"
                            enabled="{=${auditScoreModel>/bAuditScoreValidInDetailView}}"
                            visible="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_SUBMIT'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnShowHide'}" />
                        <Button id="btnSaveAuditScore" type="Emphasized" text="Submit" press="onUpdateAuditScore" 
                            enabled="{=${auditScoreModel>/bAuditScoreValidInDetailView}}"
                            visible="{parts: [{path: 'global>/viewName/AUDIT_SCORE_DETAIL'}, {path: 'global>/controlName/AUDIT_SCORE_DETAIL_SAVE'}, {path: 'auditScoreItemModel>/statusId' }], formatter: '.formatter.fnShowHide'}" />
                        <Button id="btnCancelAuditScore" type="Default" text="Cancel" press="onBackToAuditScoreList" />
                    </OverflowToolbar>
                </uxap:footer>
            </uxap:ObjectPageLayout>
        </content>
    </Page>
</mvc:View>