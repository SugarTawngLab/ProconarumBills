<mvc:View controllerName="ns.proconarumbills.controller.RequestDetail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:uxap="sap.uxap"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns="sap.m"
    xmlns:upload="sap.m.upload"
    xmlns:goals="sap.uxap.sample.SharedBlocks.goals"
    xmlns:personal="sap.uxap.sample.SharedBlocks.personal"
    xmlns:employment="sap.uxap.sample.SharedBlocks.employment" height="100%">
    <Page id="_IDGenPage"  showHeader="false" enableScrolling="true">
        <content>
            <uxap:ObjectPageLayout id="_IDGenObjectPageLayout"  showTitleInHeaderContent="true" showEditHeaderButton="false" editHeaderButtonPress="handleEditBtnPress" upperCaseAnchorBar="false" showFooter="true">
                <uxap:headerTitle>
                    <uxap:ObjectPageDynamicHeaderTitle id="_IDGenObjectPageDynamicHeaderTitle" >
                        <uxap:expandedHeading>
                            <Title id="_IDGenTitle"  text="{RequestDetails>/description}" wrapping="true"/>
                        </uxap:expandedHeading>
                        <uxap:snappedHeading>
                            <FlexBox id="_IDGenFlexBox" fitContainer="true" alignItems="Center">
                                <Title id="_IDGenTitle1"  text="{RequestDetails>/description}" wrapping="true" />
                            </FlexBox>
                        </uxap:snappedHeading>                   

                        <uxap:expandedContent>
                            <HBox id="_IDGenHBox">
                                <Title id="_IDGenTitle2" text="Status: " class="sapUiTinyMarginEnd" />
                                <ObjectStatus id="auditScoreDetailStatus" text="{RequestDetails>/status}" />
                            </HBox>

                            <HBox id="_IDGenHBox1">
                                <Title id="_IDGenTitle3" text="Total Amount: " class="sapUiTinyMarginEnd"/>
                                <ObjectStatus id="auditScoreDetailSupplier" text="5.000.000 VND" />
                            </HBox>

                            <HBox id="_IDGenHBox2">
                                <Title id="_IDGenTitle4" text="Created By: " class="sapUiTinyMarginEnd"/>
                                <ObjectStatus id="auditScoreDetailAuditType" text="{RequestDetails>/createdBy}" />
                            </HBox>

                            <HBox id="_IDGenHBox3">
                                <Title id="_IDGenTitle5" text="Created At: " class="sapUiTinyMarginEnd"/>
                                <ObjectStatus id="auditScoreDetailCreatedAt" text="{
                                    path: 'RequestDetails>/createdAt',
                                    type: 'sap.ui.model.odata.type.DateTimeOffset',
                                    constraints: {
                                        precision: 3,
                                        v4: true
                                    }                                
                                }"/>
                            </HBox>
                        </uxap:expandedContent>

                        <uxap:snappedContent>
                             <HBox id="_IDGenHBox4">
                                <Title id="_IDGenTitle6"  text="Status: " class="sapUiTinyMarginEnd" />
                                <ObjectStatus id="_IDGenObjectStatus"  text="{RequestDetails>/status}" />
                            </HBox>

                            <HBox id="_IDGenHBox5" >
                                <Title id="_IDGenTitle7"  text="Total Amount: " class="sapUiTinyMarginEnd"/>
                                <ObjectStatus id="_IDGenObjectStatus1"  text="5.000.000 VND" />
                            </HBox>

                            <HBox id="_IDGenHBox6" >
                                <Title id="_IDGenTitle8"  text="Created By: " class="sapUiTinyMarginEnd"/>
                                <ObjectStatus id="_IDGenObjectStatus2"  text="{RequestDetails>/createdBy}" />
                            </HBox>

                            <HBox id="_IDGenHBox7" >
                                <Title id="_IDGenTitle9"  text="Created At: " class="sapUiTinyMarginEnd"/>
                                <ObjectStatus id="_IDGenObjectStatus5"  text="{
                                    path: 'RequestDetails>/createdAt',
                                    type: 'sap.ui.model.odata.type.DateTimeOffset',
                                    constraints: {
                                        precision: 3,
                                        v4: true
                                    }                                
                                }"/>
                            </HBox>
                        </uxap:snappedContent>

                    </uxap:ObjectPageDynamicHeaderTitle>
                </uxap:headerTitle>

                <uxap:sections>
                    <uxap:ObjectPageSection id="_IDGenObjectPageSection" titleUppercase="false"  title="{i18n>requestHeader}">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection id="_IDGenObjectPageSubSection" >
                            <VBox id="_IDGenVBox"  width="100%">
                                <f:SimpleForm id="_IDGenSimpleForm"  editable="true" layout="ColumnLayout" labelSpanXL="2" labelSpanL="2" labelSpanM="2" labelSpanS="12" adjustLabelSpan="false" emptySpanXL="2" emptySpanL="2" emptySpanM="2" emptySpanS="2" columnsXL="2" columnsL="2" columnsM="2" singleContainerFullSize="false">
                                    <f:content>
                                        <Label id="_IDGenLabel"  text="Request Description" required="true"/>
                                        <Input id="_IDGenInput" 
                                            placeholder="Transfer Office"
                                            ariaLabelledBy="InputNumberLabel"
                                            value="{RequestDetails>/description}"
                                            class="sapUiSmallMarginBottom"
                                            change="onBasicDataValidation" 
                                            editable="true" />

                                        <Label id="_IDGenLabel1"  text="Currency" required="true"/>
                                        <Select id="_IDGenSelect"  
                                                selectedKey="{RequestDetails>/currency}"
                                                editable="true"
                                                class="sapUiSmallMarginBottom">
                                            <core:Item id="_IDGenItem"  key="{RequestDetails>/currency}" text="{RequestDetails>/currency}" />
                                        </Select>

                                        <Label id="_IDGenLabel2"  text="Priority" required="false"/>
                                        <Select id="_IDGenSelect1"  
                                                selectedKey="{RequestDetails>/priority}"
                                                editable="true"
                                                class="sapUiSmallMarginBottom">
                                            <core:Item id="_IDGenItem1"  key="{RequestDetails>/priority}" text="{RequestDetails>/priority}" />
                                        </Select>

                                        <Label id="_IDGenLabel3"  text="Due date" required="true" />
                                        <DatePicker
                                            id="_IDGenDatePicker1"
                                            change="onBasicDataValidation"
                                            editable="true"
                                            placeholder="23/04/2025"
                                            value="{
                                                path: 'RequestDetails>/dueDate',
                                                type: 'sap.ui.model.type.Date',
                                                formatOptions: {
                                                    source: {
                                                    pattern: 'dd/MM/yyyy'
                                                    },
                                                    pattern: 'dd/MM/yyyy'
                                                }
                                            }"
                                            class="sapUiSmallMarginBottom" />

                                        <Button id="_IDGenButton1"  width="0.5rem" icon="sap-icon://information" type="Transparent" press="onShowValidInputRequiredInformation"/>
                                    </f:content>
                                </f:SimpleForm>

                                <f:SimpleForm id="_IDGenSimpleForm1"  editable="true" layout="ResponsiveGridLayout" >
                                    <f:content>
                                        <Label id="_IDGenLabel4"  text="Request Information" required="true" />
                                        <TextArea id="_IDGenTextArea" editable="true"
                                                 value="{RequestDetails>/longDescription}" width="100%" rows="6" placeholder="Describe more detail your request" maxLength="5000"/>
                                    </f:content>
                                </f:SimpleForm>
                            </VBox>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <uxap:ObjectPageSection id="_IDGenObjectPageSection1"  titleUppercase="false" title="{i18n>requestItems}">
                        <uxap:subSections>
                        	<uxap:ObjectPageSubSection id="_IDGenObjectPageSubSection1"  >
                                <Table 
                                    id="_IDGenTable"
                                    busyIndicatorDelay="0"
                                    growing="true"
                                    growingThreshold="100"
                                    growingScrollToLoad="true"
                                    updateFinished="setPoTableHeader"
                                    mode="MultiSelect"
                                    sticky="ColumnHeaders,HeaderToolbar"
                                    width="auto"
                                    items="{
                                        path: 'RequestDetails>/expenseItems',
                                        sorter: {
                                            path: 'activityNo',
                                            descending: true
                                        }
                                    }">
                                    <headerToolbar>
                                        <OverflowToolbar id="_IDGenOverflowToolbar" >
                                            <Title id="_IDGenTitle10"  text="" level="H2"/>
                                            <ToolbarSpacer id="_IDGenToolbarSpacer"  />
                                            <Button id="_IDGenButton2"  text="Add Item" icon="sap-icon://add" press="onAddRow" />
                                            <Button id="_IDGenButton6"  text="Delete" icon="sap-icon://delete" press=".onDelete" />
                                        </OverflowToolbar>
                                    </headerToolbar>
                                    <columns>
                                        <!-- <Column id="activityNo" width="7%" hAlign="Left" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="Title11" text="No" class="fontWeightBold" />
                                        </Column> -->

                                        <Column id="_IDGenColumn"  hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="_IDGenText5"  text="Item Description" class="fontWeightBold" />
                                        </Column>

                                        <Column id="_IDGenColumn1"  hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="_IDGenText"  text="Amount" class="fontWeightBold" />
                                        </Column>

                                        <Column id="_IDGenColumn2"  hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="_IDGenText1"  text="Item Category" class="fontWeightBold" />
                                        </Column>

                                        <Column id="_IDGenColumn3"  hAlign="Begin" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="_IDGenText2"  text="Item Date" class="fontWeightBold" />
                                        </Column>

                                        <Column id="_IDGenColumn4"  hAlign="End" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="_IDGenText3"  text="Vendor" class="fontWeightBold" />
                                        </Column>

                                        <Column id="_IDGenColumn5"  hAlign="End" vAlign="Middle" minScreenWidth="Desktop" demandPopin="true">
                                            <Text id="_IDGenText4"  text="Remark" class="fontWeightBold" />
                                        </Column>
                                    </columns>

                                    <items>
                                    <ColumnListItem id="_IDGenColumnListItem" >
                                        <cells>
                                            <!-- <Input id="_IDGenInput" value="{ExpenseItems>Id}" /> -->
                                            <Input id="_IDGenInput6"  value="{RequestDetails>description}" />
                                            <Input id="_IDGenInput7"  value="{RequestDetails>category}" />
                                            <DatePicker id="_IDGenDatePicker2"  value="{RequestDetails>billDate}" displayFormat="yyyy-MM-dd" />
                                            <Input id="_IDGenInput8"  value="{RequestDetails>paymentMethod}" />
                                            <Input id="_IDGenInput9"  value="{RequestDetails>ammount}" />
                                            <Input id="_IDGenInput10"  value="{RequestDetails>remark}" />
                                        </cells>
                                    </ColumnListItem>
                                    </items>
                                </Table>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <uxap:ObjectPageSection id="_IDGenObjectPageSection2" titleUppercase="false" title="{i18n>requestAttachments}">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection id="_IDGenObjectPageSubSection2"  >
                                <upload:UploadSet id="_IDGenUploadSet"    
                                                    mode = "None" 
                                                    instantUpload="true"  
                                                    terminationEnabled="true" 
                                                    fileTypeMismatch="onTypeMissmatch" 
                                                    fileTypes="txt,doc,pdf,xlsx,png,jpg" 
                                                    sameFilenameAllowed="true" 
                                                    items="{AttachmentItems>/attachments}" 
                                                    fileNameLengthExceeded="onFileNameLength" 
                                                    fileSizeExceeded="onFileSizeExceeded" 
                                                    beforeItemEdited="onHandleBeforeEdit" 
                                                    afterItemEdited="onHandleAfterEditFile" 
                                                    beforeItemRemoved="onHandleBeforeRemoveFileUploadForAuditScore" 
                                                    afterItemRemoved="onHandleAfterRemoveFileUploadForAuditScore" 
                                                    afterItemAdded="onUploadItemAttachments"
                                                    uploadCompleted="onUploadCompleted"
                                                    uploadEnabled="true">
                                    <upload:items>
                                        <upload:UploadSetItem id="_IDGenUploadSetItem"  fileName="{AttachmentItems>fileName}" 
                                                                openPressed="onDownloadAttachment" 
                                                                url="#"
                                                                enabledRemove="true"
                                                                visibleEdit="false" 
                                                                visibleRemove="true">
                                                <upload:statuses>
                                                    <ObjectStatus id="_IDGenObjectStatus3"  title="{AttachmentItems>uploadedBy}" text="{AttachmentItems>createdBy}" active="false"/>
                                                    <ObjectStatus id="_IDGenObjectStatus4"  title="{AttachmentItems>uploadedOn}" 
                                                                    text="{
                                                                        path: 'AttachmentItems>createdAt',
                                                                        type: 'sap.ui.model.odata.type.DateTimeOffset',
                                                                        constraints: {
                                                                            precision: 3,
                                                                            v4: true
                                                                        }
                                                                    }" active="false"/>
                                                </upload:statuses>                
                                        </upload:UploadSetItem>
                                    </upload:items>
                                </upload:UploadSet>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <uxap:ObjectPageSection id="_IDGenObjectPageSection3"  titleUppercase="false" title="{i18n>commentOnDetailRequest}">
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection id="ObjectPageSubSectionComments">
                                <VBox id="_IDGenVBox1">
                                    <Panel id="_IDGenPanel"
                                        backgroundDesign="Transparent"
                                        headerText="">
                                        <content>
                                            <FeedInput id="_IDGenFeedInput" post=".onPostComment" placeholder="{i18n>EnterYourComment}" />
                                            <List
                                                id="idCommentsList"
                                                noDataText="{i18n>ObjectCommentNoData}"
                                                showSeparators="Inner"
                                                items="{
                                                    path: 'RequestDetails>/comments',
                                                    sorter: {
                                                        path: 'createdAt',
                                                        descending: true
                                                    }
                                                }">
                                                <FeedListItem id="_IDGenFeedListItem"
                                                    text="{RequestDetails>content}"
                                                    timestamp="{RequestDetails>createdAt}" />
                                            </List>
                                        </content>
                                    </Panel>
                                </VBox>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>
                </uxap:sections>

                <uxap:footer>
                    <OverflowToolbar id="_IDGenOverflowToolbar1" >
                        <ToolbarSpacer id="_IDGenToolbarSpacer1"  />
                        <Button id="_IDGenButton3"  type="Default" text="Save Draft" press="onSubmitAuditScore"
                            enabled="{=${auditScoreModel>/bAuditScoreValidInDetailView}}"
                            visible="true" />
                        <Button id="_IDGenButton4"  type="Emphasized" text="Submit" press="onUpdateAuditScore" 
                            enabled="{=${auditScoreModel>/bAuditScoreValidInDetailView}}"
                            visible="true" />
                        <Button id="_IDGenButton5"  type="Default" text="Cancel" press="onBackToAuditScoreList" />
                    </OverflowToolbar>
                </uxap:footer>
            </uxap:ObjectPageLayout>
        </content>
    </Page>
</mvc:View>